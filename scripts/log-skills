const fs = require("fs");
const path = require("path");
const yargs = require("yargs");

const dataFilePath = path.join(process.cwd(), "src/data/careerData.json");

const listSkills = (tags = []) => {
  fs.readFile(dataFilePath, "utf8", (err, data) => {
    if (err) {
      console.error("Error reading the JSON file:", err);
      return;
    }
    const careerData = JSON.parse(data);

    if (tags.length > 0 && tags[0] !== "") {
      const selectedSkills = careerData.skills
        .filter((skill) => tags.some((tag) => skill.tags.includes(tag)))
        .map(({ name }) => name);
      console.log(selectedSkills);
      return null;
    } else {
      console.log(careerData.skills.map(({ name }) => name));
      return null;
    }
  });
};

yargs
  .command({
    command: "$0 <tags>",
    describe: "List skills associate with a specific tag in careerData.json",
    handler: (argv) => {
      const tagsArray = argv.tags.split(",");
      console.log(tagsArray);
      listSkills(tagsArray);
    },
  })
  .help().argv;
