---
import Button from './Button.astro';
import Badge from './Badge.astro';
import TechTag from './TechTag.astro';
import ProjectMeta from './ProjectMeta.astro';

/**
 * ProjectCard Component
 * Displays a project with metadata and links
 */
export interface Props {
  project: {
    name: string;
    type: string;
    overview: string;
    technologies: string[];
    date: string;
    links: Array<{
      url: string;
      linkText: string;
      type: string;
    }>;
    roleTypes: string[];
    featured: boolean;
  };
  className?: string;
}

const { project, className = '' } = Astro.props;

// Generate slug from project name
const slug = project.name.toLowerCase().replace(/\s+/g, '-').replace(/[^a-z0-9-]/g, '');
const detailUrl = `/projects/${slug}`;

// Format date as "Month Year"
const formattedDate = new Date(project.date).toLocaleDateString('en-US', { 
  month: 'long', 
  year: 'numeric',
  timeZone: 'UTC'
});

// Map roleTypes to focus for filtering
const focusMap = {
  'software_engineer': 'engineering',
  'engineering_manager': 'engineering',
  'technical_writer': 'writing',
  'technical_writing_manager': 'writing'
};
const focus = project.roleTypes?.map(rt => focusMap[rt] || rt).join(' ');

// Get project type icon and label
const getProjectType = (type: string) => {
  const types = {
    software_engineering: { icon: 'cpu', label: 'Engineering' },
    technical_writing: { icon: 'edit-3', label: 'Writing' }
  };
  return types[type] || types.software_engineering;
};

const typeInfo = getProjectType(project.type);

// Parse links
const linksByType = project.links.reduce((acc, link) => {
  acc[link.type] = link.url;
  return acc;
}, {} as Record<string, string>);
---

<article 
  class={`project-card bg-dark-card border border-dark-border rounded-xl p-6 hover:shadow-xl hover:-translate-y-1 hover:bg-dark-hover transition-all duration-200 flex flex-col ${className}`}
  data-focus={focus} 
  data-type={project.type}
>
  <!-- Header -->
  <div class="mb-4">
    <h3 class="text-xl font-semibold text-text-primary mb-2">
      {project.name}
    </h3>
    
    <div class="flex flex-wrap items-center gap-2 mb-2">
      <Badge variant="secondary" icon={typeInfo.icon}>
        {typeInfo.label}
      </Badge>
      {project.featured && (
        <Badge variant="featured" icon="award">
          Featured
        </Badge>
      )}
    </div>
    
    <ProjectMeta date={formattedDate} className="mb-2" />
  </div>

  <!-- Overview -->
  <p class="text-text-secondary mb-4 leading-relaxed flex-grow">
    {project.overview}
  </p>

  <!-- Technologies -->
  {project.technologies.length > 0 && (
    <div class="mb-4">
      <span class="text-xs font-semibold text-text-muted uppercase tracking-wider">Technologies</span>
      <div class="flex flex-wrap gap-1 mt-1">
        {project.technologies.map((tech: string) => (
          <TechTag name={tech} variant="technology" />
        ))}
      </div>
    </div>
  )}

  <!-- Links -->
  <div class="flex flex-wrap gap-2 pt-4 border-t border-dark-border-subtle">
    <Button
      href={detailUrl}
      variant="primary"
      size="sm"
      icon="arrow-right"
      iconPosition="right"
    >
      View Details
    </Button>
  </div>
</article>
